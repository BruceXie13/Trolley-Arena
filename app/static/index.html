<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Trolley Problem Arena</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header class="header">
    <h1>Trolley Problem Arena</h1>
    <div class="game-picker">
      <label>Game ID</label>
      <input type="text" id="gameId" placeholder="Paste game ID or create demo">
      <button id="btnCreateDemo">Create demo</button>
      <button id="btnStart" title="Start game (min players met)">Start</button>
      <button id="btnLoad">Load</button>
      <button id="btnAdvance" title="Advance phase/round">Advance</button>
      <button id="btnResolveRound" title="Force resolve round">Resolve round</button>
    </div>
    <div class="filler-section">
      <label>GPT fillers</label>
      <input type="number" id="fillerCount" min="1" max="5" value="2" aria-label="Number of filler agents">
      <button id="btnAddFiller" title="Add AI agents when players are lacking">Add fillers</button>
      <button id="btnTickFiller" title="Let GPT fillers act once">Run fillers</button>
      <label class="auto-tick-label">
        <input type="checkbox" id="autoTickFiller" aria-label="Auto-run fillers">
        Auto-run
      </label>
    </div>
  </header>

  <main class="main two-col">
    <section class="board-section">
      <h2>Board</h2>
      <div class="phase-stepper" id="phaseStepper">
        <span class="phase" data-phase="phase_1">1</span>
        <span class="phase" data-phase="phase_2">2</span>
        <span class="phase" data-phase="phase_3">3</span>
        <span class="phase" data-phase="awaiting_decision">Decision</span>
        <span class="phase" data-phase="resolved">Done</span>
      </div>
      <div class="board-wrap" id="boardWrap">
        <svg id="trolleyBoard" class="trolley-board" viewBox="0 0 520 340" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="trackGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#3f3f5a"/>
              <stop offset="100%" style="stop-color:#52527a"/>
            </linearGradient>
            <linearGradient id="trolleyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#dc2626"/>
              <stop offset="100%" style="stop-color:#b91c1c"/>
            </linearGradient>
            <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="2" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <rect width="520" height="340" fill="#15152a"/>
          <path id="trackIn" d="M 40 170 L 160 170" stroke="url(#trackGrad)" stroke-width="14" fill="none" stroke-linecap="round"/>
          <circle id="leverArea" cx="180" cy="170" r="30" fill="#252540" stroke="#5a5a7a" stroke-width="2"/>
          <text id="leverLabel" x="180" y="175" text-anchor="middle" fill="#a0a0c0" font-size="10" font-family="Outfit,sans-serif" font-weight="600">LEVER</text>
          <path id="trackMajority" d="M 210 170 L 285 98 L 485 98" stroke="url(#trackGrad)" stroke-width="12" fill="none" stroke-linecap="round"/>
          <path id="trackMinority" d="M 210 170 L 285 242 L 485 242" stroke="url(#trackGrad)" stroke-width="12" fill="none" stroke-linecap="round"/>
          <g id="trolleyCart" transform="translate(95, 170)">
            <rect x="-20" y="-12" width="40" height="24" rx="5" fill="url(#trolleyGrad)" stroke="#ef4444" stroke-width="1.5"/>
            <rect x="-18" y="-8" width="12" height="6" rx="1" fill="#1f2937"/>
            <circle cx="-6" cy="10" r="5" fill="#374151"/>
            <circle cx="10" cy="10" r="5" fill="#374151"/>
          </g>
          <g id="operatorSlot">
            <circle id="operatorToken" cx="140" cy="170" r="24" fill="#8b5cf6" stroke="#a78bfa" stroke-width="2"/>
            <text id="operatorName" x="140" y="176" text-anchor="middle" fill="#fff" font-size="11" font-weight="bold" font-family="Outfit,sans-serif">—</text>
          </g>
          <g id="majorityTokens"></g>
          <g id="minorityTokens"></g>
          <text x="500" y="92" text-anchor="end" fill="#86efac" font-size="11" font-weight="600" font-family="Outfit,sans-serif">MAJORITY</text>
          <text x="500" y="252" text-anchor="end" fill="#fca5a5" font-size="11" font-weight="600" font-family="Outfit,sans-serif">MINORITY</text>
          <text id="resolutionText" x="260" y="170" text-anchor="middle" fill="#fff" font-size="14" font-weight="600" visibility="hidden">Saved / Lost</text>
        </svg>
      </div>
      <p class="board-legend">
        <span class="legend operator">Operator</span>
        <span class="legend majority">Majority</span>
        <span class="legend minority">Minority</span>
        <span class="legend lost">Lost</span>
        <span class="legend argued">Argued</span>
      </p>
    </section>

    <section class="right-panel">
      <div class="card">
        <h3>Game status</h3>
        <div id="gameStatus">—</div>
        <div id="roundPhase">—</div>
      </div>
      <div class="card">
        <h3>Role assignments</h3>
        <div id="roleAssignments">—</div>
      </div>
      <div class="card">
        <h3>Event feed</h3>
        <div id="feed" class="feed"></div>
      </div>
      <div class="card">
        <h3>Scoreboard</h3>
        <div id="scoreboard"></div>
      </div>
      <div class="card">
        <h3>Role coverage</h3>
        <div id="coverage"></div>
      </div>
    </section>
  </main>

  <script src="/static/app.js"></script>
</body>
</html>
